<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>modules/modbar.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/toolbox-team/reddit-moderator-toolbox" target="_blank" class="menu-item" >Github</a></h2><h2><a href="https://www.reddit.com/r/toolbox" target="_blank" class="menu-item" >Subreddit</a></h2><h3>Classes</h3><ul><li><a href="Module.html">Module</a><ul class='methods'><li data-type='method'><a href="Module.html#get">get</a></li><li data-type='method'><a href="Module.html#getEnabled">getEnabled</a></li><li data-type='method'><a href="Module.html#init">init</a></li><li data-type='method'><a href="Module.html#set">set</a></li><li data-type='method'><a href="Module.html#setEnabled">setEnabled</a></li></ul></li><li><a href="TBListener.html">TBListener</a><ul class='methods'><li data-type='method'><a href="TBListener.html#clear">clear</a></li><li data-type='method'><a href="TBListener.html#on">on</a></li><li data-type='method'><a href="TBListener.html#start">start</a></li><li data-type='method'><a href="TBListener.html#stop">stop</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#DISPLAY_BOTTOM">DISPLAY_BOTTOM</a></li><li><a href="global.html#DISPLAY_CENTER">DISPLAY_CENTER</a></li><li><a href="global.html#FEEDBACK_NEGATIVE">FEEDBACK_NEGATIVE</a></li><li><a href="global.html#FEEDBACK_NEUTRAL">FEEDBACK_NEUTRAL</a></li><li><a href="global.html#FEEDBACK_POSITIVE">FEEDBACK_POSITIVE</a></li><li><a href="global.html#ModNotesBadge">ModNotesBadge</a></li><li><a href="global.html#ModNotesPager">ModNotesPager</a></li><li><a href="global.html#ModNotesPopup">ModNotesPopup</a></li><li><a href="global.html#NoteTableRow">NoteTableRow</a></li><li><a href="global.html#RandomFeedback">RandomFeedback</a></li><li><a href="global.html#RandomQuote">RandomQuote</a></li><li><a href="global.html#TBsettingsObject">TBsettingsObject</a></li><li><a href="global.html#actionButton">actionButton</a></li><li><a href="global.html#addModSubsToSidebar">addModSubsToSidebar</a></li><li><a href="global.html#addToSiteTable">addToSiteTable</a></li><li><a href="global.html#addTrophiesToSidebar">addTrophiesToSidebar</a></li><li><a href="global.html#alert">alert</a></li><li><a href="global.html#baseDomain">baseDomain</a></li><li><a href="global.html#browserName">browserName</a></li><li><a href="global.html#buildSha">buildSha</a></li><li><a href="global.html#buildType">buildType</a></li><li><a href="global.html#button">button</a></li><li><a href="global.html#checkForActions">checkForActions</a></li><li><a href="global.html#cleanSubredditName">cleanSubredditName</a></li><li><a href="global.html#clearCache">clearCache</a></li><li><a href="global.html#colorNameToHex">colorNameToHex</a></li><li><a href="global.html#contextTrigger">contextTrigger</a></li><li><a href="global.html#createDeferredProcessQueue">createDeferredProcessQueue</a></li><li><a href="global.html#daysToMilliseconds">daysToMilliseconds</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#debugInformation">debugInformation</a></li><li><a href="global.html#defaultNoteLabelValueToLabelType">defaultNoteLabelValueToLabelType</a></li><li><a href="global.html#delay">delay</a></li><li><a href="global.html#displayNotes">displayNotes</a></li><li><a href="global.html#domain">domain</a></li><li><a href="global.html#escapeHTML">escapeHTML</a></li><li><a href="global.html#fetchModSubs">fetchModSubs</a></li><li><a href="global.html#fetchNewsNotes">fetchNewsNotes</a></li><li><a href="global.html#figureOutMulti">figureOutMulti</a></li><li><a href="global.html#filterModdable">filterModdable</a></li><li><a href="global.html#getActions">getActions</a></li><li><a href="global.html#getAllModNotes">getAllModNotes</a></li><li><a href="global.html#getAnonymizedSettings">getAnonymizedSettings</a></li><li><a href="global.html#getCache">getCache</a></li><li><a href="global.html#getContextURL">getContextURL</a></li><li><a href="global.html#getLastVersion">getLastVersion</a></li><li><a href="global.html#getLatestModNote">getLatestModNote</a></li><li><a href="global.html#getModSubs">getModSubs</a></li><li><a href="global.html#getModlog">getModlog</a></li><li><a href="global.html#getRandomNumber">getRandomNumber</a></li><li><a href="global.html#getSetting">getSetting</a></li><li><a href="global.html#getSettingAsync">getSettingAsync</a></li><li><a href="global.html#getSettings">getSettings</a></li><li><a href="global.html#getSubmissionFullname">getSubmissionFullname</a></li><li><a href="global.html#getSubredditColors">getSubredditColors</a></li><li><a href="global.html#getTime">getTime</a></li><li><a href="global.html#getToolboxDevs">getToolboxDevs</a></li><li><a href="global.html#handleMessage">handleMessage</a></li><li><a href="global.html#handleTBThings">handleTBThings</a></li><li><a href="global.html#handleThing">handleThing</a></li><li><a href="global.html#hideModActionsThings">hideModActionsThings</a></li><li><a href="global.html#htmlDecode">htmlDecode</a></li><li><a href="global.html#htmlEncode">htmlEncode</a></li><li><a href="global.html#humaniseDays">humaniseDays</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initialLoadPromise">initialLoadPromise</a></li><li><a href="global.html#isConfigValidVersion">isConfigValidVersion</a></li><li><a href="global.html#isEquivalent">isEquivalent</a></li><li><a href="global.html#isModSub">isModSub</a></li><li><a href="global.html#isNewModmail">isNewModmail</a></li><li><a href="global.html#isOldReddit">isOldReddit</a></li><li><a href="global.html#labelColors">labelColors</a></li><li><a href="global.html#labelNames">labelNames</a></li><li><a href="global.html#link">link</a></li><li><a href="global.html#listenerAliases">listenerAliases</a></li><li><a href="global.html#literalRegExp">literalRegExp</a></li><li><a href="global.html#makeCommentThread">makeCommentThread</a></li><li><a href="global.html#makeQueueOverlay">makeQueueOverlay</a></li><li><a href="global.html#makeSingleComment">makeSingleComment</a></li><li><a href="global.html#makeSubmissionEntry">makeSubmissionEntry</a></li><li><a href="global.html#makeUserSidebar">makeUserSidebar</a></li><li><a href="global.html#messageHandlers">messageHandlers</a></li><li><a href="global.html#millisecondsToDays">millisecondsToDays</a></li><li><a href="global.html#minutesToMilliseconds">minutesToMilliseconds</a></li><li><a href="global.html#modbarExists">modbarExists</a></li><li><a href="global.html#moveArrayItem">moveArrayItem</a></li><li><a href="global.html#newModmailSidebar">newModmailSidebar</a></li><li><a href="global.html#niceDateDiff">niceDateDiff</a></li><li><a href="global.html#notification">notification</a></li><li><a href="global.html#overlay">overlay</a></li><li><a href="global.html#pager">pager</a></li><li><a href="global.html#pagerForItems">pagerForItems</a></li><li><a href="global.html#parseComments">parseComments</a></li><li><a href="global.html#parser">parser</a></li><li><a href="global.html#popup">popup</a></li><li><a href="global.html#progressivePager">progressivePager</a></li><li><a href="global.html#purify">purify</a></li><li><a href="global.html#purifyObject">purifyObject</a></li><li><a href="global.html#regExpEscape">regExpEscape</a></li><li><a href="global.html#relativeTime">relativeTime</a></li><li><a href="global.html#reloadIframe">reloadIframe</a></li><li><a href="global.html#reloadToolbox">reloadToolbox</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#removeLastDirectoryPartOf">removeLastDirectoryPartOf</a></li><li><a href="global.html#removeQuotes">removeQuotes</a></li><li><a href="global.html#replaceAll">replaceAll</a></li><li><a href="global.html#replaceTokens">replaceTokens</a></li><li><a href="global.html#saneSort">saneSort</a></li><li><a href="global.html#saneSortAs">saneSortAs</a></li><li><a href="global.html#saveSettingsToBrowser">saveSettingsToBrowser</a></li><li><a href="global.html#searchProfile">searchProfile</a></li><li><a href="global.html#setCache">setCache</a></li><li><a href="global.html#setSetting">setSetting</a></li><li><a href="global.html#setSettingAsync">setSettingAsync</a></li><li><a href="global.html#settings">settings</a></li><li><a href="global.html#settingsToObject">settingsToObject</a></li><li><a href="global.html#shortVersion">shortVersion</a></li><li><a href="global.html#showNote">showNote</a></li><li><a href="global.html#sortBy">sortBy</a></li><li><a href="global.html#standardColors">standardColors</a></li><li><a href="global.html#stringToColor">stringToColor</a></li><li><a href="global.html#submissionFullnamesCache">submissionFullnamesCache</a></li><li><a href="global.html#tbRedditEvent">tbRedditEvent</a></li><li><a href="global.html#textFeedback">textFeedback</a></li><li><a href="global.html#timeConverterRead">timeConverterRead</a></li><li><a href="global.html#title_to_url">title_to_url</a></li><li><a href="global.html#toolboxVersion">toolboxVersion</a></li><li><a href="global.html#toolboxVersionName">toolboxVersionName</a></li><li><a href="global.html#typeNames">typeNames</a></li><li><a href="global.html#unescapeHTML">unescapeHTML</a></li><li><a href="global.html#unescapeJSON">unescapeJSON</a></li><li><a href="global.html#verifiedSettingsSave">verifiedSettingsSave</a></li><li><a href="global.html#watchForURLChanges">watchForURLChanges</a></li><li><a href="global.html#wrapWithLastValue">wrapWithLastValue</a></li><li><a href="global.html#zlibDeflate">zlibDeflate</a></li><li><a href="global.html#zlibInflate">zlibInflate</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">modules/modbar.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import $ from 'jquery';

import * as TBApi from '../tbapi.ts';
import * as TBCore from '../tbcore.js';
import * as TBHelpers from '../tbhelpers.js';
import TBModule, {Module} from '../tbmodule.jsx';
import * as TBStorage from '../tbstorage.js';
import * as TBui from '../tbui.js';

// Hold onto the modbarExists resolver so we can call it when the time is right
let resolveModbarExists = null;

/**
 * A promise which resolves when the modbar is added to the page.
 * @constant {Promise&lt;void>}
 */
export const modbarExists = new Promise(resolve => {
    resolveModbarExists = resolve;
});

export default new Module({
    name: 'Modbar',
    id: 'Modbar',
    alwaysEnabled: true,
    settings: [
        {
            id: 'compactHide',
            description: 'Use compact mode for modbar',
            type: 'boolean',
            default: false,
            advanced: true,
        },
        {
            id: 'unmoderatedOn',
            description: 'Show icon for unmoderated',
            type: 'boolean',
            default: true,
        },
        {
            id: 'enableModSubs',
            description: 'Show Moderated Subreddits in the modbar',
            type: 'boolean',
            default: true,
        },
        {
            id: 'enableOldNewToggle',
            description: 'Include a button in the modbar to swap between old and new Reddit',
            type: 'boolean',
            default: true,
        },
        {
            id: 'shortcuts',
            description: 'Shortcuts',
            type: 'map',
            default: {},
            labels: ['name', 'url'],
            hidden: false,
        },
        {
            id: 'modbarHidden',
            type: 'boolean',
            default: false,
            hidden: true,
        },
        {
            id: 'lockScroll',
            type: 'boolean',
            default: false,
            hidden: true,
        },
        {
            id: 'customCSS',
            type: 'code',
            default: '',
            hidden: true,
        },
        {
            id: 'lastExport',
            type: 'number',
            default: 0,
            hidden: true,
        },
        {
            id: 'showExportReminder',
            type: 'boolean',
            default: true,
            hidden: true,
        },
        {
            id: 'subredditColorSalt',
            type: 'text',
            default: 'PJSalt',
            hidden: true,
        },
    ],
}, async function init ({
    shortcuts,
    compactHide,
    unmoderatedOn,
    enableModSubs,
    enableOldNewToggle,
    customCSS,
    modbarHidden,
    subredditColorSalt,
}) {
    // Clean up old settings related to the now-removed dev console
    // TODO: Remove this a couple versions from now when people have reasonably
    //       probably updated past this
    TBStorage.setSettingAsync(this.id, 'consoleShowing', undefined);

    const $body = $('body');

    // Footer element below the page so toolbox never should be in the way.
    // Doing it like this because it means we don't have to mess with reddit css
    const $footerblock = $('&lt;div id="tb-footer-block">').appendTo($body);

    // Don't add the mod bar to embedded pages or if not logged in
    if (TBCore.isEmbedded || !await TBApi.getCurrentUser()) {
        return;
    }

    // This prevents some weird scrollbar behavior on new reddit iframe embeds.
    window.addEventListener('TBNewPage', event => {
        const pageType = event.detail.pageType;
        if (pageType === 'oldModmail' || pageType === 'message') {
            $footerblock.hide();
        } else {
            $footerblock.show();
            const {url} = getDirectingTo();
            $('#tb-old-new-reddit-toggle').attr('href', url);
        }
    });

    //
    // preload some generic variables
    //

    const debugMode = await TBStorage.getSettingAsync('Utils', 'debugMode', false);

    const modSubreddits = await TBStorage.getSettingAsync('Notifier', 'modSubreddits', 'mod');
    const unmoderatedSubreddits = await TBStorage.getSettingAsync('Notifier', 'unmoderatedSubreddits', 'mod');
    const unreadMessageCount = await TBStorage.getSettingAsync('Notifier', 'unreadMessageCount', 0);
    const modqueueCount = await TBStorage.getSettingAsync('Notifier', 'modqueueCount', 0);
    const unmoderatedCount = await TBStorage.getSettingAsync('Notifier', 'unmoderatedCount', 0);
    const modmailCount = await TBStorage.getSettingAsync('Notifier', 'modmailCount', 0);
    const newModmailCount = await TBStorage.getSettingAsync('Notifier', 'newModmailCount', 0);
    const notifierEnabled = await TBStorage.getSettingAsync('Notifier', 'enabled', true);

    const modSubredditsFMod = await TBStorage.getSettingAsync('Notifier', 'modSubredditsFMod', false);
    const unmoderatedSubredditsFMod = await TBStorage.getSettingAsync('Notifier', 'unmoderatedSubredditsFMod', false);

    // Ready some details for new modmail linking
    const modmailLink = await TBStorage.getSettingAsync('NewModMail', 'modmaillink', 'all_modmail');
    const openMailTab = await TBStorage.getSettingAsync('NewModMail', 'openmailtab', false) &amp;&amp; !TBCore.isNewModmail;
    const newModmailBaseUrl = 'https://mod.reddit.com/mail/';
    let newModmailUrl;

    switch (modmailLink) {
        case 'all_modmail':
            newModmailUrl = `${newModmailBaseUrl}all`;

            break;
        case 'inbox':
            newModmailUrl = `${newModmailBaseUrl}inbox`;

            break;
        case 'new':
            newModmailUrl = `${newModmailBaseUrl}new`;

            break;
        case 'in_progress':
            newModmailUrl = `${newModmailBaseUrl}inprogress`;

            break;
        case 'archived':
            newModmailUrl = `${newModmailBaseUrl}archived`;

            break;
        case 'highlighted':
            newModmailUrl = `${newModmailBaseUrl}highlighted`;

            break;
        case 'mod_discussions':
            newModmailUrl = `${newModmailBaseUrl}mod`;

            break;
        case 'notifications':
            newModmailUrl = `${newModmailBaseUrl}notifications`;
    }

    // Custom CSS for debug mode/testing
    if (customCSS) {
        $('head').append(`&lt;style type="text/css">${customCSS}&lt;/style>`);
    }

    //
    // UI elements
    //
    // style="display: none;"
    // toolbar, this will display all counters, quick links and other settings for the toolbox

    const modQueueUrl = TBCore.link(
        modSubredditsFMod ? '/me/f/mod/about/modqueue/' : `/r/${modSubreddits}/about/modqueue`,
    );
    const $modBar = $(`
&lt;div id="tb-bottombar">
    &lt;a class="tb-bottombar-hide tb-icons" href="javascript:void(0)">${TBui.icons.arrowLeft}&lt;/a>
    &lt;a class="tb-toolbar-new-settings tb-icons" href="javascript:void(0)" title="toolbox settings">${TBui.icons.settings}&lt;/a>
    &lt;label class="tb-first-run">&amp;#060;-- Click for settings&lt;/label>
    &lt;span id="tb-bottombar-contentleft">
        &lt;span id="tb-toolbarshortcuts">&lt;/span>
    &lt;/span>
    &lt;span id="tb-bottombar-contentright">
        &lt;span id="tb-toolbarcounters">
            &lt;a title="no mail" href="${
        TBCore.link('/message/inbox/')
    }" class="nohavemail tb-icons" id="tb-mail">${TBui.icons.userInbox}&lt;/a>
            &lt;a href="${TBCore.link('/message/inbox/')}" id="tb-mailCount">&lt;/a>
            &lt;a href="${newModmailUrl}" class="nohavemail access-required tb-icons" id="tb-new_modmail" ${
        openMailTab ? 'target="_blank"' : ''
    }>${TBui.icons.modmail}&lt;/a>
            &lt;a href="${newModmailUrl}" id="tb-new-modmailcount" ${openMailTab ? 'target="_blank"' : ''}>&lt;/a>
            &lt;a title="modqueue" href="${modQueueUrl}" id="tb-modqueue" class="tb-icons">${TBui.icons.modqueue}&lt;/a>
            &lt;a href="${modQueueUrl}" id="tb-queueCount">&lt;/a>
        &lt;/span>
    &lt;/span>
    &lt;div id="tb-new-modmail-tooltip">
        &lt;table>
            &lt;tr id="tb-new-modmail-new">
                &lt;td class="tb-new-mm-category">&lt;a href="https://mod.reddit.com/mail/new" id="tb-new-modmailcount" ${
        openMailTab ? 'target="_blank"' : ''
    }>New&lt;/a>&lt;/td>
                &lt;td class="tb-new-mm-count">&lt;/td>
            &lt;/tr>
            &lt;tr id="tb-new-modmail-inprogress">
                &lt;td class="tb-new-mm-category">&lt;a href="https://mod.reddit.com/mail/inprogress" id="tb-new-modmailcount" ${
        openMailTab ? 'target="_blank"' : ''
    }>In Progress&lt;/a>&lt;/td>
                &lt;td class="tb-new-mm-count">&lt;/td>
            &lt;/tr>
            &lt;tr id="tb-new-modmail-banappeals">
                &lt;td class="tb-new-mm-category">&lt;a href="https://mod.reddit.com/mail/appeals" id="tb-new-modmailcount" ${
        openMailTab ? 'target="_blank"' : ''
    }>Ban Appeals&lt;/a>&lt;/td>
                &lt;td class="tb-new-mm-count">&lt;/td>
            &lt;/tr>
            &lt;tr id="tb-new-modmail-joinrequests">
                &lt;td class="tb-new-mm-category">&lt;a href="https://mod.reddit.com/mail/join_requests" id="tb-new-modmailcount" ${
        openMailTab ? 'target="_blank"' : ''
    }>Join Requests&lt;/a>&lt;/td>
                &lt;td class="tb-new-mm-count">&lt;/td>
            &lt;/tr>
            &lt;tr id="tb-new-modmail-highlighted">
                &lt;td class="tb-new-mm-category">&lt;a href="https://mod.reddit.com/mail/highlighted" id="tb-new-modmailcount" ${
        openMailTab ? 'target="_blank"' : ''
    }>Highlighted&lt;/a>&lt;/td>
                &lt;td class="tb-new-mm-count">&lt;/td>
            &lt;/tr>
            &lt;tr id="tb-new-modmail-mod">
                &lt;td class="tb-new-mm-category">&lt;a href="https://mod.reddit.com/mail/mod" id="tb-new-modmailcount" ${
        openMailTab ? 'target="_blank"' : ''
    }>Mod Discussions&lt;/a>&lt;/td>
                &lt;td class="tb-new-mm-count">&lt;/td>
            &lt;/tr>
            &lt;tr id="tb-new-modmail-notifications">
                &lt;td class="tb-new-mm-category">&lt;a href="https://mod.reddit.com/mail/notifications" id="tb-new-modmailcount" ${
        openMailTab ? 'target="_blank"' : ''
    }>Notifications&lt;/a>&lt;/td>
                &lt;td class="tb-new-mm-count">&lt;/td>
            &lt;/tr>
    &lt;/div>
&lt;/div>
`);
    let hoverTimeout;
    $modBar.find('#tb-new_modmail, #tb-new-modmailcount, #tb-new-modmail-tooltip').hover(() => {
        clearTimeout(hoverTimeout);
        $modBar.find('#tb-new-modmail-tooltip').show();
    }, () => {
        hoverTimeout = setTimeout(() => {
            $modBar.find('#tb-new-modmail-tooltip').hide(100);
        }, 1000);
    });

    // Add unmoderated icon if it is enabled.

    if (unmoderatedOn) {
        const unModQueueUrl = TBCore.link(
            unmoderatedSubredditsFMod
                ? '/me/f/mod/about/unmoderated/'
                : `/r/${unmoderatedSubreddits}/about/unmoderated`,
        );
        $modBar.find('#tb-toolbarcounters').append(`
&lt;a title="unmoderated" href="${unModQueueUrl}" class="tb-icons" id="tb-unmoderated">${TBui.icons.unmoderated}&lt;/a>
&lt;a href="${unModQueueUrl}" id="tb-unmoderatedCount">&lt;/a>
`);
    }

    const $modbarhid = $(`
&lt;div id="tb-bottombar-hidden" class="${compactHide ? 'tb-bottombar-compact' : ''}">
    &lt;a class="tb-bottombar-unhide tb-icons" href="javascript:void(0)">${
        compactHide ? TBui.icons.dotMenu : TBui.icons.arrowRight
    }&lt;/a>
&lt;/div>
`);

    $body.append($modBar);
    $body.append($modbarhid);

    const toggleMenuBar = hidden => {
        if (hidden) {
            $modBar.hide();
            $modbarhid.show();
            $body.toggleClass('tb-modbar-shown', false); // New modmail uses this style to add space to the bottom of the page
        } else {
            $modBar.show();
            $modbarhid.hide();
            $body.toggleClass('tb-modbar-shown', true);
        }
        this.set('modbarHidden', hidden);
    };

    // Always default to hidden in compact mode
    if (compactHide) {
        modbarHidden = true;
    }

    toggleMenuBar(modbarHidden);

    // modbar was added to the DOM, let everyone know so they can add buttons and stuff
    resolveModbarExists();

    // moderated subreddits button.
    if (enableModSubs) {
        TBCore.getModSubs(true).then(async mySubsData => {
            if (!mySubsData.length) {
                return;
            }
            $body.find('#tb-bottombar-contentleft').prepend(
                '&lt;a href="javascript:void(0)" class="tb-modbar-button" id="tb-toolbar-mysubs" style="display: none">Moderated Subreddits&lt;/a> ',
            );

            let subList = '';

            const configEnabled = await TBStorage.getSettingAsync('TBConfig', 'enabled', false);
            const usernotesEnabled = await TBStorage.getSettingAsync('UserNotes', 'enabled', false);
            this.log('got mod subs');
            this.log(mySubsData.length);

            $(mySubsData).each(function () {
                const subColor = TBHelpers.stringToColor(this.subreddit + subredditColorSalt);
                subList += `
                    &lt;tr style="border-left: solid 3px ${subColor} !important;" data-subreddit="${this.subreddit}">
                        &lt;td class="tb-my-subreddits-name">&lt;a title="/r/${this.subreddit}" href="${
                    TBCore.link(`/r/${this.subreddit}`)
                }" target="_blank">/r/${this.subreddit}&lt;/a>&lt;/td>
                        &lt;td class="tb-my-subreddits-subreddit">
                            &lt;a title="/r/${this.subreddit} modqueue" target="_blank" href="${
                    TBCore.link(`/r/${this.subreddit}/about/modqueue`)
                }" data-type="modqueue" data-subreddit="${this.subreddit}" class="tb-icons">${TBui.icons.modqueue}&lt;/a>
                            &lt;a title="/r/${this.subreddit} unmoderated" target="_blank" href="${
                    TBCore.link(`/r/${this.subreddit}/about/unmoderated`)
                }" data-type="unmoderated" data-subreddit="${this.subreddit}" class="tb-icons">${TBui.icons.unmoderated}&lt;/a>
                            &lt;a title="/r/${this.subreddit} moderation log" target="_blank" href="${
                    TBCore.link(`/r/${this.subreddit}/about/log`)
                }" data-type="modlog" data-subreddit="${this.subreddit}" class="tb-icons">${TBui.icons.modlog}&lt;/a>
                            &lt;a title="/r/${this.subreddit} traffic stats" target="_blank" href="${
                    TBCore.link(`/r/${this.subreddit}/about/traffic`)
                }" data-type="traffic" data-subreddit="${this.subreddit}" class="tb-icons">${TBui.icons.subTraffic}&lt;/a>
                            ${
                    usernotesEnabled
                        ? `&lt;a title="/r/${this.subreddit} usernotes" href="javascript:;" class="tb-un-config-link tb-icons" data-subreddit="${this.subreddit}">${TBui.icons.usernote}&lt;/a>`
                        : ''
                }
                            ${
                    configEnabled
                        ? `&lt;a title="/r/${this.subreddit} config" href="javascript:;" class="tb-config-link tb-icons" data-subreddit="${this.subreddit}">${TBui.icons.tbSubConfig}&lt;/a>`
                        : ''
                }
                        &lt;/td>
                    &lt;/tr>
                `;
            });

            const modSubsPopupContent = `
                &lt;div id="tb-my-subreddits">
                    &lt;input id="tb-livefilter-input" type="text" class="tb-input" placeholder="live search" value="">
                &lt;span class="tb-livefilter-count">${mySubsData.length}&lt;/span>
                    &lt;br>
                    &lt;table id="tb-my-subreddit-list">${subList}&lt;/table>
                &lt;/div>
            `;

            $body.on('click', '#tb-toolbar-mysubs', () => {
                const $existingPopup = $body.find('.subreddits-you-mod-popup');
                if (!$existingPopup.length) {
                    TBui.popup({
                        title: 'Subreddits you moderate',
                        tabs: [
                            {
                                title: 'Subreddits you moderate',
                                id: 'sub-you-mod', // reddit has things with class .role, so it's easier to do this than target CSS
                                tooltip: 'Subreddits you moderate',
                                content: modSubsPopupContent,
                                footer: '',
                            },
                        ],
                        cssClass: 'subreddits-you-mod-popup',
                    }).appendTo('body').css({
                        position: 'fixed',
                        bottom: '41px',
                        left: '20px',
                    });
                    // Focus the filter bar for convenience
                    $('#tb-livefilter-input').focus();
                } else {
                    $existingPopup.remove();
                }

                $body.find('#tb-livefilter-input').keyup(function () {
                    const LiveSearchValue = $(this).val();
                    $body.find('#tb-my-subreddits table tr').each(function () {
                        const $this = $(this);
                        const subredditName = $this.attr('data-subreddit');

                        if (subredditName.toUpperCase().indexOf(LiveSearchValue.toUpperCase()) &lt; 0) {
                            $this.hide();
                        } else {
                            $this.show();
                        }
                        $('.tb-livefilter-count').text($('#tb-my-subreddits table tr:visible').length);
                    });
                });
            });

            // only show the button once it's populated.
            $('#tb-toolbar-mysubs').show();
        });
    }

    // Swap old/new reddit button
    if (enableOldNewToggle &amp;&amp; !TBCore.isNewModmail) {
        const {url, directingTo} = getDirectingTo();
        // Append the link
        $('#tb-bottombar-contentleft').append(`
                &lt;a href="${url}" id="tb-old-new-reddit-toggle" class="tb-modbar-button" title="View this page in ${directingTo}">Open in ${directingTo}&lt;/a>
            `);
    }

    TBCore.getLastVersion().then(lastVersion => {
        if (lastVersion &lt; TBCore.shortVersion) {
            $('.tb-first-run').show().css('display', 'inline-block');
        }
    });

    // Always add version label to modbar on non-stable versions
    if (TBCore.buildType !== 'stable') {
        $('#tb-bottombar').find('#tb-toolbarcounters').before(
            $(`
                &lt;button
                    id="tb-prerelease-link"
                    href="${TBCore.link('/r/tb_beta')}"
                    target="_blank"
                    title="this is a ${TBCore.buildType} build of toolbox. click to copy version information"
                />
                    &lt;i class="tb-icons">${TBui.icons.prerelease}&lt;/i>
                    &lt;span>${TBCore.toolboxVersion}&lt;/span>
                &lt;/button>
            `).on('click', () => {
                navigator.clipboard.writeText(TBCore.toolboxVersion).then(() => {
                    TBui.textFeedback(
                        'Copied version information to clipboard',
                        TBui.TextFeedbackKind.POSITIVE,
                        undefined,
                        TBui.TextFeedbackLocation.BOTTOM,
                    );
                }).catch(error => {
                    TBui.textFeedback(
                        `Failed to copy version info: ${error.message}`,
                        TBui.TextFeedbackKind.NEGATIVE,
                        undefined,
                        TBui.TextFeedbackLocation.BOTTOM,
                    );
                });
            }),
        );
    }

    if (debugMode) {
        // Reload button
        $('#tb-bottombar').find('#tb-toolbarcounters').before(
            `&lt;a href="javascript:;" id="tb-reload-link" class="tb-icons" title="reload toolbox">${TBui.icons.tbReload}&lt;/a>`,
        );

        $body.on('click', '#tb-reload-link', () => {
            this.log('reloading chrome');
            TBui.reloadToolbox();
        });
    }

    // Append shortcuts
    Object.entries(shortcuts).forEach(([index, value]) => {
        // TODO: Separators here should probably use CSS rather than having nested elements and stuff
        const $shortcut = $(
            `&lt;a class="tb-no-gustavobc" href="${TBHelpers.htmlEncode(unescape(value))}">${
                TBHelpers.htmlEncode(unescape(index))
            }&lt;/a>`,
        );
        $shortcut.appendTo('#tb-toolbarshortcuts');
    });

    // Show/hide menubar
    $body.on('click', '.tb-bottombar-unhide, .tb-bottombar-hide', function () {
        toggleMenuBar($(this).hasClass('tb-bottombar-hide'));
    });

    // Show counts on hover
    let $modBarHidTooltip = $body.find('#tb-modbar-hide-tooltip');
    $modbarhid.mouseenter(() => {
        if (!notifierEnabled || compactHide) {
            return;
        }

        const hoverContent = `
                &lt;table>
                    &lt;tr>
                        &lt;td>New Messages&lt;/td>
                        &lt;td>${unreadMessageCount}&lt;/td>
                    &lt;/tr>
                    &lt;tr >
                        &lt;td>Mod Queue&lt;/td>
                        &lt;td>${modqueueCount}&lt;/td>
                    &lt;/tr>
                    &lt;tr >
                        &lt;td>Unmoderated Queue&lt;/td>
                        &lt;td>${unmoderatedCount}&lt;/td>
                    &lt;/tr>
                    &lt;tr>
                        &lt;td>Mod Mail&lt;/td>
                        &lt;td >${modmailCount}&lt;/td>
                    &lt;/tr>
                    &lt;tr>
                        &lt;td>New Mod Mail&lt;/td>
                        &lt;td >${newModmailCount}&lt;/td>
                    &lt;/tr>
                &lt;/table>
            `;

        if (!$modBarHidTooltip.length) {
            $modBarHidTooltip = $('&lt;div id="tb-modbar-hide-tooltip">&lt;/div>').appendTo($body);
        }
        $modBarHidTooltip.html(TBStorage.purify(hoverContent));
        $modBarHidTooltip.fadeIn(200);
    }).mouseleave(() => {
        $modBarHidTooltip.fadeOut(200);
    });

    // Open the settings
    $body.on('click', '.tb-toolbar-new-settings', () => {
        if ($('.tb-settings').length) {
            return;
        } // Don't show the window twice
        TBModule.showSettings();
    });

    // check for passed settings.
    function switchTab (module) {
        const $this = $body.find(`[data-module="${module}"]`);
        const $tb_help_mains = $('.tb-help-main');

        // achievement support
        if (module === 'about') {
            TBCore.sendEvent(TBCore.events.TB_ABOUT_PAGE);
        }
        if (module === 'syntax') {
            TBCore.sendEvent(TBCore.events.TB_SYNTAX_SETTINGS);
        }

        $('.tb-window-tabs a').removeClass('active');
        $this.addClass('active');

        $tb_help_mains.attr('currentpage', module);
        // if we have module name, give that to the help button
        if ($this.data('module')) {
            $tb_help_mains.data('module', $this.data('module'));
        }
        $('.tb-personal-settings .tb-window .tb-window-tab').hide();
        $(`.tb-personal-settings .tb-window .tb-window-tab.${module}`).show();
    }

    window.addEventListener('TBHashParams', event => {
        let module = event.detail.tbsettings;
        if (module) {
            let setting = event.detail.setting;
            this.log(setting);
            module = module.toLowerCase();

            if (setting) {
                setting = setting.toLowerCase();
                const id = `#tb-${module}-${setting}`;
                let highlightedCSS =
                    `${id} p {background-color: ${TBui.standardColors.softyellow}; display: block !important;}`;

                // this next line is to deal with legacy settings
                highlightedCSS +=
                    `${id}{background-color: ${TBui.standardColors.softyellow}; display: block !important;}`;
                highlightedCSS += `.tb-setting-link-${setting} {display: inline !important;}`;

                $('head').append(`&lt;style type="text/css">${highlightedCSS}&lt;/style>`);
            }

            // Wait a sec for stuff to load.
            setTimeout(async () => {
                // prevent tbsetting URL hash from persisting on reload.
                history.pushState('', document.title, window.location.pathname);
                await TBModule.showSettings();
                switchTab(module);
            }, 500);
        }
    });

    // change tabs
    $body.on('click', '.tb-window-tabs a:not(.active)', function () {
        const tab = $(this).attr('data-module');
        switchTab(tab);
    });
});

function getDirectingTo () {
    let url = window.location.href.replace(/^http:/, 'https:');
    let directingTo;
    if (url.startsWith('https://old.')) {
        url = url.replace('old.', 'www.');
        directingTo = 'new Reddit';
    } else if (url.startsWith('https://sh.')) {
        url = url.replace('sh.', 'www.');
        directingTo = 'old Reddit';
    } else {
        // Redirect to old Reddit on the redesign, new Reddit otherwise
        url = url.replace(/https:\/\/.*?\.reddit/, TBCore.isOldReddit ? 'https://sh.reddit' : 'https://old.reddit');
        directingTo = TBCore.isOldReddit ? 'new Reddit' : 'old Reddit';
    }
    return {url, directingTo};
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Fri Dec 13 2024 06:15:54 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
